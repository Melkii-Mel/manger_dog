{% extends "bases/static_main.html" %}

{% block title %}{{ super() }} - {{ trans(key="auth", lang=lang) }}{% endblock title %}

{% block main %}

<div class="auth-block">
    <script src="/static/js/common-validators.js"></script>
    <script>
        go_to_app_if_authorized()
        const error_messages = JSON.parse(`{{ trans(key='error_messages', lang=lang) | safe }}`);

        function mode() {
            const params = new URLSearchParams(window.location.search);
            return params.get("mode");
        }
    </script>
    <script src="/static/js/form-init.js"></script>
    <form class="auth-form sign-up-form" method="post">
        <h1>{{ trans(key='sign_up', lang=lang) }}</h1>
        {{ macros::form_input(title=trans(key='registration_form_username_field', lang=lang), type="text",
        name="username") }}
        {{ macros::form_input(title=trans(key='registration_form_email_field', lang=lang), type="email", name="email",
        autocomplete="email") }}
        {{ macros::form_input(title=trans(key='registration_form_password_field', lang=lang), type="password",
        autocomplete="new-password",
        name="password") }}
        <button type="submit">{{ trans(key='sign_up', lang=lang) }}</button>
        <a class="change-auth-mode" href="?mode=sign_in">{{ trans(key='have_account_login', lang=lang) }}</a>
        <script>
            const sign_up_form = document.currentScript.parentElement;
            {
                form_init(sign_up_form, {
                    username: common_validators.not_empty,
                    email: common_validators.email,
                    password: (e) => common_validators.password(e, 0),
                }, "/register");
                if (mode() === "sign_in") {
                    sign_up_form.classList.add("gone");
                }
            }
        </script>
    </form>
    <form class="auth-form sign-in-form">
        <h1>{{ trans(key='sign_in', lang=lang) }}</h1>
        {{ macros::form_input(title=trans(key='registration_form_email_field', lang=lang), type="email", name="email",
        autocomplete="email") }}
        {{ macros::form_input(title=trans(key='registration_form_password_field', lang=lang), type="password",
        autocomplete="current-password",
        name="password") }}
        <button type="submit">{{ trans(key='sign_in', lang=lang) }}</button>
        <a class="change-auth-mode" href="?mode=sign_up">{{ trans(key='no_account_register', lang=lang) }}</a>
        <script>
            const sign_in_form = document.currentScript.parentElement;
            {
                form_init(document.currentScript.parentElement, {
                    email: common_validators.not_empty,
                    password: common_validators.not_empty,
                }, "/login");
                if (mode() !== "sign_in") {
                    sign_in_form.classList.add("gone");
                }
            }
        </script>
    </form>
    <script>
        document.querySelectorAll(".change-auth-mode").forEach(a => a.addEventListener("click", e => {
            e.preventDefault();
            const url = new URL(window.location.href);
            url.searchParams.set("mode", a.href.split("=")[1]);
            history.pushState(null, "", url.href);
            sign_up_form.classList.toggle("gone");
            sign_in_form.classList.toggle("gone");
        }))
    </script>
</div>

{% endblock main %}
